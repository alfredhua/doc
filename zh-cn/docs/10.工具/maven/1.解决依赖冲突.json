{
  "filename": "1.解决依赖冲突.md",
  "__html": "<h3 id=\"%E8%A7%A3%E5%86%B3%E4%BE%9D%E8%B5%96\">解决依赖 <a class=\"header-anchor\" href=\"#%E8%A7%A3%E5%86%B3%E4%BE%9D%E8%B5%96\">#</a></h3>\n<p>依赖同一个库时可能会发生依赖冲突，导致程序奔溃。依赖冲突表现为在运行中出现NoSuchMethodError或者ClassNotFoundException的异常或者其他与类加载相关的JVM异常。</p>\n<p>此时，若能确定classpath中存在这个包，则错误是因为classpath中存在2个不同版本的jar包了，比如常见的log4j，你在classpath中添加了log4j.jar，而spark的lib目录中也有log4j.jar，而且这2个jar包版本不一致的话，就会出现依赖冲突问题。</p>\n<p>解决办法有2种：</p>\n<ol>\n<li>修改你的应用，使其使用的依赖库的版本与Spark所使用的相同。</li>\n<li>使用称为shading的方式打包你的应用。使用maven-shade-plugin插件进行高级配置来支持这种打包方式。shading可以让你以另一种命名空间保留冲突的包，并自动重写应用的代码使得它们使用重命名后的版本。这种技术有些简单粗暴，不过对于解决运行时依赖冲突的问题非常有效。</li>\n</ol>\n<p>Maven:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>maven-shade-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>package<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>shade<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relocations</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relocation</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pattern</span>&gt;</span>org.apache.http<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pattern</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">shadedPattern</span>&gt;</span>hidden.org.apache.http<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">shadedPattern</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">relocation</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relocation</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pattern</span>&gt;</span>org.apache.logging<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pattern</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">shadedPattern</span>&gt;</span>hidden.org.apache.logging<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">shadedPattern</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">relocation</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relocation</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pattern</span>&gt;</span>org.apache.commons.codec<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pattern</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">shadedPattern</span>&gt;</span>hidden.org.apache.commons.codec<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">shadedPattern</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">relocation</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relocation</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pattern</span>&gt;</span>org.apache.commons.logging<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pattern</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">shadedPattern</span>&gt;</span>hidden.org.apache.commons.logging<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">shadedPattern</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">relocation</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">relocations</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span>\n</code></pre>\n<p>Gradle:</p>\n<pre><code class=\"language-gradle\">shadowJar {\n    relocate <span class=\"hljs-string\">'org.apache.http'</span>, <span class=\"hljs-string\">'hidden.org.apache.http'</span>\n    relocate <span class=\"hljs-string\">'org.apache.logging'</span>, <span class=\"hljs-string\">'hidden.org.apache.logging'</span>\n    relocate <span class=\"hljs-string\">'org.apache.commons.codec'</span>, <span class=\"hljs-string\">'hidden.org.apache.commons.codec'</span>\n    relocate <span class=\"hljs-string\">'org.apache.commons.logging'</span>, <span class=\"hljs-string\">'hidden.org.apache.commons.logging'</span>\n}\n</code></pre>\n",
  "link": "/zh-cn/docs/10.工具/maven/1.解决依赖冲突.html",
  "meta": {}
}