{
  "filename": "1Hadoop集群搭建.md",
  "__html": "<h2 id=\"%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92\">集群规划 <a class=\"header-anchor\" href=\"#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92\">#</a></h2>\n<p><img src=\"https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/DDdMQe.png\" alt=\"image\"></p>\n<h2 id=\"%E7%AB%AF%E5%8F%A3%E8%AF%B4%E6%98%8E\">端口说明 <a class=\"header-anchor\" href=\"#%E7%AB%AF%E5%8F%A3%E8%AF%B4%E6%98%8E\">#</a></h2>\n<table>\n<thead>\n<tr>\n<th>端口名称</th>\n<th>Hadoop2.X</th>\n<th>Hadoop.x</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NameNode 内部通信端口</td>\n<td>8020 / 9000</td>\n<td>8020 / 9000/9820</td>\n</tr>\n<tr>\n<td>NameNode HTTP UI</td>\n<td>50070</td>\n<td>9870</td>\n</tr>\n<tr>\n<td>MapReduce 查看执行任务端</td>\n<td>8088</td>\n<td>8088</td>\n</tr>\n<tr>\n<td>历史服务器通信端口</td>\n<td>19888</td>\n<td>19888</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8\">创建容器 <a class=\"header-anchor\" href=\"#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8\">#</a></h2>\n<table>\n<thead>\n<tr>\n<th>a</th>\n<th>hadoop02</th>\n<th>hadoop03</th>\n<th>hadoop04</th>\n<th>Hadoop04</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HDFS</td>\n<td>NameNode，DataNode</td>\n<td>DataNode</td>\n<td>SecondaryNameNode，DataNode</td>\n<td></td>\n</tr>\n<tr>\n<td>Yarn</td>\n<td>NodeManager</td>\n<td>ResourceManager，NodeManager</td>\n<td>NodeManager</td>\n<td></td>\n</tr>\n<tr>\n<td>Port</td>\n<td></td>\n<td>19888，9870</td>\n<td>8088</td>\n<td>9868</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>hdfs namenode -format <a href=\"http://xn--start-dfs-pw9o.sh\">和start-dfs.sh</a></td>\n<td><a href=\"http://start-yarn.sh\">start-yarn.sh</a></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4\">开始执行命令 <a class=\"header-anchor\" href=\"#%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4\">#</a></h2>\n<h4 id=\"%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C\">创建网络 <a class=\"header-anchor\" href=\"#%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C\">#</a></h4>\n<pre><code class=\"language-she\">docker network create -d bridge net --subnet=172.18.0.0/24 --gateway=172.18.0.1\n</code></pre>\n<h4 id=\"hadoop01\">hadoop01 <a class=\"header-anchor\" href=\"#hadoop01\">#</a></h4>\n<pre><code class=\"language-shell\">docker run -itd --privileged=true --name  hadoop01 --net net --ip  172.18.0.11 guozhenhua/hadoop:4 /usr/sbin/init\n</code></pre>\n<h4 id=\"hadoop02\">Hadoop02 <a class=\"header-anchor\" href=\"#hadoop02\">#</a></h4>\n<pre><code class=\"language-shell\">docker run -itd --privileged=true --name  hadoop02 --net net --ip  172.18.0.12 -p 9870:9870 -p 19888:19888 guozhenhua/hadoop:3   /usr/sbin/init\n</code></pre>\n<h4 id=\"hadoop03\">Hadoop03 <a class=\"header-anchor\" href=\"#hadoop03\">#</a></h4>\n<pre><code class=\"language-shell\">docker run -itd --privileged=true --name  hadoop03 --net net --ip  172.18.0.13 -p 8088:8088 guozhenhua/hadoop:3   /usr/sbin/init\n</code></pre>\n<h4 id=\"hadoop04\">Hadoop04 <a class=\"header-anchor\" href=\"#hadoop04\">#</a></h4>\n<pre><code class=\"language-shel\">docker run -itd --privileged=true --name  hadoop04 --net net --ip  172.18.0.14 -p 9868:9868 guozhenhua/hadoop:3   /usr/sbin/init\n</code></pre>\n<h3 id=\"%E5%9C%A8hadoop02%E4%B8%8A\">在hadoop02上 <a class=\"header-anchor\" href=\"#%E5%9C%A8hadoop02%E4%B8%8A\">#</a></h3>\n<ul>\n<li>切换用户：su hadoop</li>\n<li>执行： hdfs namenode -format</li>\n<li>执行：<a href=\"http://start-dfs.sh\">start-dfs.sh</a></li>\n</ul>\n<h4 id=\"%E5%9C%A8hadoop03%E4%B8%8A\">在hadoop03上 <a class=\"header-anchor\" href=\"#%E5%9C%A8hadoop03%E4%B8%8A\">#</a></h4>\n<ul>\n<li>切换用户：su hadoop</li>\n<li>执行：<a href=\"http://start-yarn.sh\">start-yarn.sh</a></li>\n</ul>\n<p><img src=\"https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/MMytru.png\" alt=\"image\"></p>\n<h4 id=\"%E6%B5%8B%E8%AF%95\">测试 <a class=\"header-anchor\" href=\"#%E6%B5%8B%E8%AF%95\">#</a></h4>\n<ul>\n<li>hadoop fs -mkdir /input</li>\n</ul>\n<p><img src=\"https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/khpzp7.png\" alt=\"image\"></p>\n<ul>\n<li>访问页面：<a href=\"http://127.0.0.1:9870/explorer.html#/input\">http://127.0.0.1:9870/explorer.html#/input</a></li>\n</ul>\n<p><img src=\"https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/SdEF7y.png\" alt=\"image\"></p>\n<h2 id=\"%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B%E5%9B%9E%E9%A1%BE\">搭建过程回顾 <a class=\"header-anchor\" href=\"#%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B%E5%9B%9E%E9%A1%BE\">#</a></h2>\n<h3 id=\"1.-%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83\">1. 构建环境 <a class=\"header-anchor\" href=\"#1.-%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83\">#</a></h3>\n<ul>\n<li>\n<p>下载centos:7容器。</p>\n<pre><code class=\"language-shell\">docker pull centos:7\n</code></pre>\n</li>\n<li>\n<p>创建用户</p>\n<pre><code class=\"language-shell\">useradd hadoop\npasswd hadoop\n</code></pre>\n</li>\n<li>\n<p>配置JAVA的环境。</p>\n<pre><code class=\"language-shell\">下载jdk，配置JAVA_HOME\n</code></pre>\n</li>\n<li>\n<p>配置hadoop的环境。</p>\n<pre><code class=\"language-shell\">下载hadoop软件即可： https://ftp.jaist.ac.jp/pub/apache/hadoop/common/hadoop-3.2.2/hadoop-3.2.2.tar.gz\n</code></pre>\n</li>\n<li>\n<p>设置ssh免密码登陆</p>\n<pre><code class=\"language-shell\">默认是不存在ssh登陆的，所以需要安装openssh服务yum install install openssh-client openssh-server修改配置 vim /etc/ssh/sshd_config\n</code></pre>\n</li>\n<li>\n<p>根据集群规划配置/etc/hosts</p>\n<pre><code class=\"language-shel\">按照IP配置172.18.0.11  hadoop01172.18.0.12  hadoop02172.18.0.13  hadoop03172.18.0.14  hadoop04\n</code></pre>\n</li>\n<li>\n<p>配置hadoop的配置</p>\n<blockquote>\n<p>配置 core-site.xml</p>\n</blockquote>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span><span class=\"hljs-comment\">&lt;!-- 指定 NameNode 的地址 --&gt;</span>   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>fs.defaultFS<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>hdfs://hadoop02:8020<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>  <span class=\"hljs-comment\">&lt;!-- 指定 hadoop 数据的存储目录 --&gt;</span>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>hadoop.tmp.dir<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>/home/hadoop/data<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>  <span class=\"hljs-comment\">&lt;!-- 配置 HDFS 网页登录使用的静态用户为 --&gt;</span>   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>hadoop.http.staticuser.user<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</code></pre>\n<blockquote>\n<p>配置hdfs-site.xml</p>\n</blockquote>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span>\t     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>dfs.namenode.http-address<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>        \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>hadoop02:9870<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-comment\">&lt;!-- 2nn web 端访问地址--&gt;</span>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>hadoop04:9868<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>       <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</code></pre>\n<blockquote>\n<p>配置 yarn-site.xml</p>\n</blockquote>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span><span class=\"hljs-comment\">&lt;!-- Site specific YARN configuration properties --&gt;</span><span class=\"hljs-comment\">&lt;!-- 指定 MR 走 shuffle --&gt;</span> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>yarn.nodemanager.aux-services<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>mapreduce_shuffle<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-comment\">&lt;!-- 指定 ResourceManager 的地址--&gt;</span> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>yarn.resourcemanager.hostname<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>hadoop03<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-comment\">&lt;!-- 环境变量的继承 --&gt;</span>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CO NF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAP RED_HOME<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</code></pre>\n<blockquote>\n<p>配置 mapred-site.xml</p>\n</blockquote>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>mapreduce.framework.name<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>       <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">value</span>&gt;</span>yarn<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">value</span>&gt;</span>   <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</code></pre>\n<blockquote>\n<p>配置 workers</p>\n</blockquote>\n<pre><code class=\"language-xml\">hadoop02hadoop03hadoop04\n</code></pre>\n</li>\n</ul>\n<h2 id=\"docker-compose-%E9%85%8D%E7%BD%AE\">docker-compose 配置 <a class=\"header-anchor\" href=\"#docker-compose-%E9%85%8D%E7%BD%AE\">#</a></h2>\n<blockquote>\n<p>以下是直接搭建好的集群环境，可以直接使用 docker-compose 启动容器。</p>\n<p>启动容器后需启动hadoop集群</p>\n<h3 id=\"%E5%9C%A8hadoop02%E4%B8%8A-1\">在hadoop02上 <a class=\"header-anchor\" href=\"#%E5%9C%A8hadoop02%E4%B8%8A-1\">#</a></h3>\n<ul>\n<li>切换用户：su hadoop</li>\n<li>执行： hdfs namenode -format</li>\n<li>执行：<a href=\"http://start-dfs.sh\">start-dfs.sh</a></li>\n</ul>\n<h4 id=\"%E5%9C%A8hadoop03%E4%B8%8A-1\">在hadoop03上 <a class=\"header-anchor\" href=\"#%E5%9C%A8hadoop03%E4%B8%8A-1\">#</a></h4>\n<ul>\n<li>\n<p>切换用户：su hadoop</p>\n</li>\n<li>\n<p>执行：<a href=\"http://start-yarn.sh\">start-yarn.sh</a></p>\n</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-yml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">\"3\"</span><span class=\"hljs-attr\">services:  hadoop02:    image: guozhenhua/hadoop:5    container_name: hadoop02    privileged: true    ports:      - 9870:9870    networks:      net1:        ipv4_address: 172.18.0.12  hadoop03:    image: guozhenhua/hadoop:5    container_name: hadoop03    privileged: true    ports:      - 8088:8088    networks:      net1:        ipv4_address: 172.18.0.13        hadoop04:    image: guozhenhua/hadoop:5    container_name: hadoop04    privileged: true    ports:      - 9868:9868    networks:      net1:        ipv4_address: 172.18.0.14networks:  net1:    driver: bridge    ipam:      config:        - subnet: 172.18.0.0/24          gateway:</span> <span class=\"hljs-number\">172.18</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>\n</code></pre>\n<p><strong>注意：</strong></p>\n<ul>\n<li>配置文件中的**IP地址和container_name **不可随意更改。如需要更改，需要修改容器中的/etc/hosts。</li>\n<li>privileged: true 这个是必须的，否则会导致sshd服务不可启动，集群启动无法连接登陆。</li>\n</ul>\n",
  "link": "/zh-cn/docs/11.大数据/1Hadoop集群搭建.html",
  "meta": {}
}