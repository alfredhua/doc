<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="8.JVM常用工具" />
	<meta name="description" content="8.JVM常用工具" />
	<!-- 网页标签标题 -->
	<title>8.JVM常用工具</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a class="logo" href="/zh-cn/index.html"><span class="logo-normal">码农阿华| <span class="logo-desc">玩玩技术，说说产品</span></span></a><div class="search search-normal"><span class="icon-search"></span></div><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/begin.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>设计模式</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>设计原则<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/2.开闭原则.html" target="_self">开闭原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/3.接口隔离原则.html" target="_self">接口隔离原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>JAVA</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>目录<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/dir/demo3.html" target="_self">示例3</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><ol>
<li>
<p>jconsole</p>
<p>JConsole工具是JDK自带的可视化监控工具。查看java应用程序的运行概况、监控堆信息、永久区使用 情况、类加载情况等。</p>
<p>命令行中输入:jconsole</p>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/3b6a1d2fce9a4efe9bc56d5f4d5ecc75.png" alt="image"></p>
</li>
<li>
<p>jvisualvm</p>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/7831d41ed5154237b0110172ba5aad83.png" alt="image"></p>
<ul>
<li>
<p>监控本地Java进程 可以监控本地的java进程的CPU，类，线程等。</p>
</li>
<li>
<p>监控远端Java进程</p>
<p>比如监控远端tomcat，演示部署在阿里云服务器上的tomcat</p>
<p>(1)在visualvm中选中“远程”，右击“添加”</p>
<p>(2)主机名上写服务器的ip地址，比如31.100.39.63，然后点击“确定”</p>
<p>(3)右击该主机“31.100.39.63”，添加“JMX”[也就是通过JMX技术具体监控远端服务器哪个Java进程]</p>
<p>(4)要想让服务器上的tomcat被连接，需要改一下 bin/catalina.sh 这个文件</p>
<p>(5)在 ../conf 文件中添加两个文件jmxremote.access和jmxremote.password</p>
<p>mxremote.access 文件内容：</p>
<pre><code>  guest readonly
  manager readwrite
</code></pre>
<p>jmxremote.password 文件内容：</p>
<pre><code>  guest guest
  manager manager
</code></pre>
<p>授权： chmod 600 <em>jmxremot</em></p>
<p>(6)将连接服务器地址改为公网ip地址</p>
<p>hostname -i 查看输出情况 172.26.225.240 172.17.0.1
vim /etc/hosts</p>
<p>172.26.255.240 31.100.39.63</p>
<p>(7)设置上述端口对应的阿里云安全策略和防火墙策略</p>
<p>(8)启动tomcat，来到bin目录
./startup.sh</p>
<p>(9)查看tomcat启动日志以及端口监听</p>
<pre><code>  tail -f ../logs/catalina.out 
  lsof -i tcp:8080
</code></pre>
<p>(10)查看8998监听情况，可以发现多开了几个端口</p>
<pre><code>  lsof -i:8998 得到PID
  netstat -antup | grep PID
</code></pre>
<p>(11)在刚才的JMX中输入8998端口，并且输入用户名和密码则登录成功</p>
<pre><code>  端口:8998 用户名:manager 密码:manager
</code></pre>
</li>
</ul>
</li>
<li>
<p>Arthas</p>
<p>github地址:<a href="https://github.com/alibaba/arthas">https://github.com/alibaba/arthas</a>
文档：<a href="https://alibaba.github.io/arthas/">https://alibaba.github.io/arthas/</a></p>
<p>Arthas 是Alibaba开源的Java诊断工具，采用命令行交互模式，是排查jvm相关问题的利器。</p>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/9389beed4ff44547bb550114549a7a25.png" alt="image"></p>
</li>
</ol>
<p>常用命令</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>version</td>
<td>查看arthas版本号</td>
</tr>
<tr>
<td>help</td>
<td>查看命名帮助信息</td>
</tr>
<tr>
<td>cls</td>
<td>清空屏幕</td>
</tr>
<tr>
<td>session</td>
<td>查看当前会话信息</td>
</tr>
<tr>
<td>quit</td>
<td>退出arthas客户端</td>
</tr>
<tr>
<td>dashboard</td>
<td>当前进程的实时数据面板</td>
</tr>
<tr>
<td>thread</td>
<td>当前JVM的线程堆栈信息</td>
</tr>
<tr>
<td>jvm</td>
<td>查看当前JVM的信息</td>
</tr>
<tr>
<td>sysprop</td>
<td>查看JVM的系统属性</td>
</tr>
<tr>
<td>sc</td>
<td>查看JVM已经加载的类信息</td>
</tr>
<tr>
<td>dump</td>
<td>dump已经加载类的byte code到特定目录</td>
</tr>
<tr>
<td>jad</td>
<td>反编译指定已加载类的源码</td>
</tr>
<tr>
<td>monitor</td>
<td>方法执行监控</td>
</tr>
<tr>
<td>watch</td>
<td>方法执行数据观测</td>
</tr>
<tr>
<td>trace</td>
<td>方法内部调用路径，并输出方法路径上的每个节点上耗时</td>
</tr>
<tr>
<td>stack</td>
<td>输出当前方法被调用的调用路径</td>
</tr>
</tbody>
</table>
<ol start="4">
<li>
<p>MAT</p>
<p>Java堆分析器，用于查找内存泄漏</p>
<p>Heap Dump，称为堆转储文件，是Java进程在某个时间内的快照</p>
<p>下载地址 :<a href="https://www.eclipse.org/mat/downloads.php">https://www.eclipse.org/mat/downloads.php</a></p>
<p>获取Dump文件：</p>
<ul>
<li>
<p>手动：jmap -dump:format=b,file=heap.hprof 44808</p>
</li>
<li>
<p>自动：-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=heap.hprof</p>
</li>
</ul>
</li>
<li>
<p>在线分析工具 <a href="http://gceasy.io">gceasy.io</a></p>
</li>
</ol>
</div></section><footer class="footer-container"><div class="footer-body"><div class="cols-container"><div class="col col-12"><h3>码农阿华</h3><p>联系邮箱：alfredhua@aliyun.com</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/demo1.html" target="_self">概览</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd></dl></div></div><div class="copyright"><span>CopyRight©2019 版权所有 码农阿华 京ICP备19044364号</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>