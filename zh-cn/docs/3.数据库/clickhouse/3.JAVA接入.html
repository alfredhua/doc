<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="3.JAVA接入" />
	<meta name="description" content="3.JAVA接入" />
	<!-- 网页标签标题 -->
	<title>3.JAVA接入</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a class="logo" href="/zh-cn/index.html"><span class="logo-normal">码农阿华| <span class="logo-desc">玩玩技术，说说产品</span></span></a><div class="search search-normal"><span class="icon-search"></span></div><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/begin.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>设计模式</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>设计原则<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/2.开闭原则.html" target="_self">开闭原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/3.接口隔离原则.html" target="_self">接口隔离原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>JAVA</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>目录<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/dir/demo3.html" target="_self">示例3</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h2 id="%E5%A2%9E%E5%8A%A0table%E8%A1%A8">增加table表 <a class="header-anchor" href="#%E5%A2%9E%E5%8A%A0table%E8%A1%A8">#</a></h2>
<pre><code class="language-java">CREATE TABLE <span class="hljs-keyword">default</span>.user_info (
	id Int64,
	<span class="hljs-function">user_name <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span>,
	phone <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span>,
	email <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span>,
	create_time DateTime
)  ENGINE </span>=  Log;
</code></pre>
<h2 id="1.-%E5%BC%95%E5%85%A5jar%E5%8C%85">1. 引入JAR包 <a class="header-anchor" href="#1.-%E5%BC%95%E5%85%A5jar%E5%8C%85">#</a></h2>
<pre><code class="language-java">       &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.3.2&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- clickhouse --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ru.yandex.clickhouse&lt;/groupId&gt;
            &lt;artifactId&gt;clickhouse-jdbc&lt;/artifactId&gt;
            &lt;version&gt;0.1.53&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Druid 数据连接池依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;1.1.21&lt;/version&gt;
        &lt;/dependency&gt;

</code></pre>
<h2 id="2.-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2. 修改配置文件 <a class="header-anchor" href="#2.-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">#</a></h2>
<pre><code class="language-java">
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.click.url= jdbc:clickhouse:<span class="hljs-comment">//127.0.0.1:8123/default</span>
spring.datasource.click.username= <span class="hljs-keyword">default</span>
spring.datasource.click.password=
spring.datasource.click.driverClassName= ru.yandex.clickhouse.ClickHouseDriver
spring.datasource.click.initialSize= <span class="hljs-number">10</span>
spring.datasource.click.maxActive= <span class="hljs-number">100</span>
spring.datasource.click.minIdle= <span class="hljs-number">10</span>
spring.datasource.click.maxWait= <span class="hljs-number">6000</span>
</code></pre>
<h2 id="3.-%E5%A2%9E%E5%8A%A0druid%E9%85%8D%E7%BD%AE">3. 增加druid配置 <a class="header-anchor" href="#3.-%E5%A2%9E%E5%8A%A0druid%E9%85%8D%E7%BD%AE">#</a></h2>
<pre><code class="language-java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource.click"</span>)
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClickHouseConfig</span> </span>{
    <span class="hljs-keyword">private</span> String driverClassName ;
    <span class="hljs-keyword">private</span> String url ;
    <span class="hljs-keyword">private</span> Integer initialSize ;
    <span class="hljs-keyword">private</span> Integer maxActive ;
    <span class="hljs-keyword">private</span> Integer minIdle ;
    <span class="hljs-keyword">private</span> Integer maxWait ;
    <span class="hljs-comment">// 省略get和set</span>
}


<span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSource;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> javax.sql.DataSource;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfig</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ClickHouseConfig clickHouseConfig;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> </span>{
        System.out.printf(clickHouseConfig.toString());
        DruidDataSource datasource = <span class="hljs-keyword">new</span> DruidDataSource();
        datasource.setUrl(clickHouseConfig.getUrl());
        datasource.setDriverClassName(clickHouseConfig.getDriverClassName());
        datasource.setInitialSize(clickHouseConfig.getInitialSize());
        datasource.setMinIdle(clickHouseConfig.getMinIdle());
        datasource.setMaxActive(clickHouseConfig.getMaxActive());
        datasource.setMaxWait(clickHouseConfig.getMaxWait());
        <span class="hljs-keyword">return</span> datasource;
    }
}

</code></pre>
<h2 id="4.-%E5%A2%9E%E5%8A%A0service%E5%92%8Cmapper">4. 增加service和Mapper <a class="header-anchor" href="#4.-%E5%A2%9E%E5%8A%A0service%E5%92%8Cmapper">#</a></h2>
<pre><code class="language-java"><span class="hljs-keyword">import</span> com.clickhouse.entity.UserInfo;
<span class="hljs-keyword">import</span> io.lettuce.core.dynamic.annotation.Param;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Insert;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserInfoMapper</span> </span>{

  <span class="hljs-meta">@Insert</span>(<span class="hljs-string">"insert into user_info(id,user_name,phone,email,create_time)values(#{id},#{user_name},#{phone},#{email},#{create_time})"</span>)
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">saveUserInfo</span><span class="hljs-params">(UserInfo userInfo)</span> </span>;

  <span class="hljs-meta">@Select</span>(<span class="hljs-string">"select * from user_info where id=#{id} "</span>)
  <span class="hljs-function">UserInfo <span class="hljs-title">selectById</span><span class="hljs-params">(@Param(<span class="hljs-string">"id"</span>)</span> Long id) </span>;

  <span class="hljs-meta">@Select</span>(<span class="hljs-string">"select * from user_info"</span>)
  <span class="hljs-function">List&lt;UserInfo&gt; <span class="hljs-title">selectList</span><span class="hljs-params">()</span> </span>;
}


<span class="hljs-keyword">import</span> com.clickhouse.entity.UserInfo;
<span class="hljs-keyword">import</span> com.clickhouse.mapper.UserInfoMapper;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> guozhenhua
 * <span class="hljs-doctag">@date</span> 2020/11/21
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfoServiceImpl</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    UserInfoMapper userInfoMapper;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveUserInfo</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;<span class="hljs-number">100</span>;i++){
            UserInfo userInfo=<span class="hljs-keyword">new</span> UserInfo();
            userInfo.setId((<span class="hljs-keyword">long</span>) i);
            userInfo.setPhone(<span class="hljs-string">"183183"</span>+i);
            userInfo.setEmail(<span class="hljs-string">"76"</span>+i+<span class="hljs-string">"@qq.com"</span>);
            userInfo.setUser_name(<span class="hljs-string">"华"</span>+i);
            userInfo.setCreate_time(LocalDateTime.now());
            userInfoMapper.saveUserInfo(userInfo);
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserInfo <span class="hljs-title">getById</span><span class="hljs-params">(Long id)</span></span>{
        <span class="hljs-keyword">return</span> userInfoMapper.selectById(id);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserInfo&gt; <span class="hljs-title">getAll</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> userInfoMapper.selectList();
    }

}

</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><div class="cols-container"><div class="col col-12"><h3>码农阿华</h3><p>联系邮箱：alfredhua@aliyun.com</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/demo1.html" target="_self">概览</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd></dl></div></div><div class="copyright"><span>CopyRight©2019 版权所有 码农阿华 京ICP备19044364号</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>