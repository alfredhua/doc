{
  "filename": "3.JAVA接入.md",
  "__html": "<h2 id=\"%E5%A2%9E%E5%8A%A0table%E8%A1%A8\">增加table表 <a class=\"header-anchor\" href=\"#%E5%A2%9E%E5%8A%A0table%E8%A1%A8\">#</a></h2>\n<pre><code class=\"language-java\">CREATE TABLE <span class=\"hljs-keyword\">default</span>.user_info (\n\tid Int64,\n\t<span class=\"hljs-function\">user_name <span class=\"hljs-title\">String</span><span class=\"hljs-params\">(<span class=\"hljs-number\">100</span>)</span>,\n\tphone <span class=\"hljs-title\">String</span><span class=\"hljs-params\">(<span class=\"hljs-number\">100</span>)</span>,\n\temail <span class=\"hljs-title\">String</span><span class=\"hljs-params\">(<span class=\"hljs-number\">100</span>)</span>,\n\tcreate_time DateTime\n)  ENGINE </span>=  Log;\n</code></pre>\n<h2 id=\"1.-%E5%BC%95%E5%85%A5jar%E5%8C%85\">1. 引入JAR包 <a class=\"header-anchor\" href=\"#1.-%E5%BC%95%E5%85%A5jar%E5%8C%85\">#</a></h2>\n<pre><code class=\"language-java\">       &lt;dependency&gt;\n            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;\n            &lt;version&gt;1.3.2&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- clickhouse --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;ru.yandex.clickhouse&lt;/groupId&gt;\n            &lt;artifactId&gt;clickhouse-jdbc&lt;/artifactId&gt;\n            &lt;version&gt;0.1.53&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- Druid 数据连接池依赖 --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n            &lt;artifactId&gt;druid&lt;/artifactId&gt;\n            &lt;version&gt;1.1.21&lt;/version&gt;\n        &lt;/dependency&gt;\n\n</code></pre>\n<h2 id=\"2.-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">2. 修改配置文件 <a class=\"header-anchor\" href=\"#2.-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">#</a></h2>\n<pre><code class=\"language-java\">\nspring.datasource.type=com.alibaba.druid.pool.DruidDataSource\nspring.datasource.click.url= jdbc:clickhouse:<span class=\"hljs-comment\">//127.0.0.1:8123/default</span>\nspring.datasource.click.username= <span class=\"hljs-keyword\">default</span>\nspring.datasource.click.password=\nspring.datasource.click.driverClassName= ru.yandex.clickhouse.ClickHouseDriver\nspring.datasource.click.initialSize= <span class=\"hljs-number\">10</span>\nspring.datasource.click.maxActive= <span class=\"hljs-number\">100</span>\nspring.datasource.click.minIdle= <span class=\"hljs-number\">10</span>\nspring.datasource.click.maxWait= <span class=\"hljs-number\">6000</span>\n</code></pre>\n<h2 id=\"3.-%E5%A2%9E%E5%8A%A0druid%E9%85%8D%E7%BD%AE\">3. 增加druid配置 <a class=\"header-anchor\" href=\"#3.-%E5%A2%9E%E5%8A%A0druid%E9%85%8D%E7%BD%AE\">#</a></h2>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">import</span> lombok.Data;\n<span class=\"hljs-keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;\n<span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;\n\n<span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.click\"</span>)\n<span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ClickHouseConfig</span> </span>{\n    <span class=\"hljs-keyword\">private</span> String driverClassName ;\n    <span class=\"hljs-keyword\">private</span> String url ;\n    <span class=\"hljs-keyword\">private</span> Integer initialSize ;\n    <span class=\"hljs-keyword\">private</span> Integer maxActive ;\n    <span class=\"hljs-keyword\">private</span> Integer minIdle ;\n    <span class=\"hljs-keyword\">private</span> Integer maxWait ;\n    <span class=\"hljs-comment\">// 省略get和set</span>\n}\n\n\n<span class=\"hljs-keyword\">import</span> com.alibaba.druid.pool.DruidDataSource;\n<span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;\n<span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;\n<span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;\n<span class=\"hljs-keyword\">import</span> javax.sql.DataSource;\n\n<span class=\"hljs-meta\">@Configuration</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DruidConfig</span> </span>{\n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> ClickHouseConfig clickHouseConfig;\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">()</span> </span>{\n        System.out.printf(clickHouseConfig.toString());\n        DruidDataSource datasource = <span class=\"hljs-keyword\">new</span> DruidDataSource();\n        datasource.setUrl(clickHouseConfig.getUrl());\n        datasource.setDriverClassName(clickHouseConfig.getDriverClassName());\n        datasource.setInitialSize(clickHouseConfig.getInitialSize());\n        datasource.setMinIdle(clickHouseConfig.getMinIdle());\n        datasource.setMaxActive(clickHouseConfig.getMaxActive());\n        datasource.setMaxWait(clickHouseConfig.getMaxWait());\n        <span class=\"hljs-keyword\">return</span> datasource;\n    }\n}\n\n</code></pre>\n<h2 id=\"4.-%E5%A2%9E%E5%8A%A0service%E5%92%8Cmapper\">4. 增加service和Mapper <a class=\"header-anchor\" href=\"#4.-%E5%A2%9E%E5%8A%A0service%E5%92%8Cmapper\">#</a></h2>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">import</span> com.clickhouse.entity.UserInfo;\n<span class=\"hljs-keyword\">import</span> io.lettuce.core.dynamic.annotation.Param;\n<span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Insert;\n<span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Mapper;\n<span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Select;\n\n<span class=\"hljs-keyword\">import</span> java.util.List;\n\n<span class=\"hljs-meta\">@Mapper</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserInfoMapper</span> </span>{\n\n  <span class=\"hljs-meta\">@Insert</span>(<span class=\"hljs-string\">\"insert into user_info(id,user_name,phone,email,create_time)values(#{id},#{user_name},#{phone},#{email},#{create_time})\"</span>)\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">saveUserInfo</span><span class=\"hljs-params\">(UserInfo userInfo)</span> </span>;\n\n  <span class=\"hljs-meta\">@Select</span>(<span class=\"hljs-string\">\"select * from user_info where id=#{id} \"</span>)\n  <span class=\"hljs-function\">UserInfo <span class=\"hljs-title\">selectById</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"id\"</span>)</span> Long id) </span>;\n\n  <span class=\"hljs-meta\">@Select</span>(<span class=\"hljs-string\">\"select * from user_info\"</span>)\n  <span class=\"hljs-function\">List&lt;UserInfo&gt; <span class=\"hljs-title\">selectList</span><span class=\"hljs-params\">()</span> </span>;\n}\n\n\n<span class=\"hljs-keyword\">import</span> com.clickhouse.entity.UserInfo;\n<span class=\"hljs-keyword\">import</span> com.clickhouse.mapper.UserInfoMapper;\n<span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;\n<span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;\n\n<span class=\"hljs-keyword\">import</span> java.time.LocalDateTime;\n<span class=\"hljs-keyword\">import</span> java.util.List;\n\n<span class=\"hljs-comment\">/**\n * <span class=\"hljs-doctag\">@author</span> guozhenhua\n * <span class=\"hljs-doctag\">@date</span> 2020/11/21\n */</span>\n<span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserInfoServiceImpl</span> </span>{\n    <span class=\"hljs-meta\">@Autowired</span>\n    UserInfoMapper userInfoMapper;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">saveUserInfo</span><span class=\"hljs-params\">()</span></span>{\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">1</span>;i&lt;<span class=\"hljs-number\">100</span>;i++){\n            UserInfo userInfo=<span class=\"hljs-keyword\">new</span> UserInfo();\n            userInfo.setId((<span class=\"hljs-keyword\">long</span>) i);\n            userInfo.setPhone(<span class=\"hljs-string\">\"183183\"</span>+i);\n            userInfo.setEmail(<span class=\"hljs-string\">\"76\"</span>+i+<span class=\"hljs-string\">\"@qq.com\"</span>);\n            userInfo.setUser_name(<span class=\"hljs-string\">\"华\"</span>+i);\n            userInfo.setCreate_time(LocalDateTime.now());\n            userInfoMapper.saveUserInfo(userInfo);\n        }\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> UserInfo <span class=\"hljs-title\">getById</span><span class=\"hljs-params\">(Long id)</span></span>{\n        <span class=\"hljs-keyword\">return</span> userInfoMapper.selectById(id);\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;UserInfo&gt; <span class=\"hljs-title\">getAll</span><span class=\"hljs-params\">()</span></span>{\n        <span class=\"hljs-keyword\">return</span> userInfoMapper.selectList();\n    }\n\n}\n\n</code></pre>\n",
  "link": "/zh-cn/docs/3.数据库/clickhouse/3.JAVA接入.html",
  "meta": {}
}