<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="8.多字段特性及自定义Analyzer" />
	<meta name="description" content="8.多字段特性及自定义Analyzer" />
	<!-- 网页标签标题 -->
	<title>8.多字段特性及自定义Analyzer</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a class="logo" href="/zh-cn/index.html"><span class="logo-normal">码农阿华| <span class="logo-desc">玩玩技术，说说产品</span></span></a><div class="search search-normal"><span class="icon-search"></span></div><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/begin.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>设计模式</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>设计原则<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/2.开闭原则.html" target="_self">开闭原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/3.接口隔离原则.html" target="_self">接口隔离原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>JAVA</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>目录<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/dir/demo3.html" target="_self">示例3</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h2 id="%E5%A4%9A%E5%AD%97%E6%AE%B5%E7%89%B9%E6%80%A7">多字段特性 <a class="header-anchor" href="#%E5%A4%9A%E5%AD%97%E6%AE%B5%E7%89%B9%E6%80%A7">#</a></h2>
<ul>
<li>
<p>厂商名字直接实现精确匹配</p>
<ul>
<li>增加一个keyword字段</li>
</ul>
</li>
<li>
<p>使用不同的analyzer</p>
<ul>
<li>不同语言</li>
<li>拼音字段的搜索</li>
<li>支持为搜索和索引指定不同的analyzer</li>
</ul>
</li>
</ul>
<h2 id="exact-values-v.s-full-text">Exact Values v.s Full Text <a class="header-anchor" href="#exact-values-v.s-full-text">#</a></h2>
<ul>
<li>
<p>Exact Values ： 包括数字、日期、具体的一个字符串（“Apple Store&quot;）</p>
</li>
<li>
<p>es 中的keyword</p>
</li>
<li>
<p>Full Text： 全文本，非结构化的文本数据</p>
<ul>
<li>es 中的 text</li>
</ul>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/TXLpGz.png" alt="image"></p>
</li>
</ul>
<h2 id="%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E8%AF%8D">自定义分词 <a class="header-anchor" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E8%AF%8D">#</a></h2>
<blockquote>
<p>当Elasticsearch 自带的分词器无法满足时，可以自定义分词，通过自组合不同的组件实现</p>
</blockquote>
<h2 id="character-filters">Character Filters <a class="header-anchor" href="#character-filters">#</a></h2>
<blockquote>
<p>在Tokenizer之前对文本进行处理，例如增加删除及替换字符可以配置多个Character Filter。会影响Tokenizer的position和offset的信息</p>
</blockquote>
<p>自带的Character Filer</p>
<ul>
<li>
<p>HTML strip ：去除html标签</p>
<pre><code class="language-json">POST _analyze
{
  "tokenizer": "keyword",
  "char_filter": ["html_strip"],
  "text":"&lt;b&gt;hello word&lt;/b&gt;"
}
</code></pre>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/2uww2y.png" alt="image"></p>
</li>
<li>
<p>Mapping ： 字符串替换</p>
<pre><code class="language-json">POST _analyze
{
  "tokenizer": "keyword",
  "char_filter": [
    { 
      "type":"mapping",
      "mappings":["- =&gt; _"]
    }
  ],
  "text":"123-213-23-sd-324-df"
}
</code></pre>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/Ey8RQZ.png" alt="image"></p>
</li>
<li>
<p>Pattern replace : 正则匹配替换</p>
<pre><code class="language-json">GET _analyze
{
  "tokenizer": "standard",
  "char_filter": [
      {
        "type" : "pattern_replace",
        "pattern" : "http://(.*)",
        "replacement" : "$1"
      }
    ],
    "text" : "http://www.elastic.co"
}
</code></pre>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/tXaVxG.png" alt="image"></p>
</li>
</ul>
<h2 id="tokeizer">Tokeizer <a class="header-anchor" href="#tokeizer">#</a></h2>
<blockquote>
<p>将原始的文本按照一定的规则，切分为词。</p>
</blockquote>
<ul>
<li>
<p>Elasticsearch 内置的Tokenizers</p>
<p>Whitespace / standard / uax_url_email / pattern / keyword /path_hieracrchy</p>
</li>
</ul>
<p>举例：</p>
<ul>
<li>whitespace</li>
</ul>
<pre><code class="language-json">POST _analyze
{
  "tokenizer": "whitespace",
  "filter": ["stop"], 
  "text": "The rain in Spain falls mainly on the plain"
}
</code></pre>
<pre><code>- path_hieracrchy
</code></pre>
<pre><code class="language-json">POST _analyze
{
  "tokenizer": "path_hierarchy",
  "text": "/user/hua/a/b/c/d/e"
}
</code></pre>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/bPsGcL.png" alt="image"></p>
<ul>
<li>可以用java开发插件，实现自己的tokenizer</li>
</ul>
<h2 id="token-filters">Token Filters <a class="header-anchor" href="#token-filters">#</a></h2>
<blockquote>
<p>将tokenizer输出的单词，进行增加，修改，删除。</p>
</blockquote>
<p>自带的 token Filters</p>
<p>lowercase / stop /synonym</p>
<h2 id="%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA-custom-analyzer">设置一个 Custom Analyzer <a class="header-anchor" href="#%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA-custom-analyzer">#</a></h2>
<pre><code class="language-json">PUT t_index
{
  "settings": {
    "analysis": {
      "analyzer": {     
        "my_analyzer":{   
          "tokenizer":"standard",
          "char_filter":"my_char_filter"  
        }
      },
      "char_filter": {    
        "my_char_filter":{  
          "type":"mapping", 
          "mappings":[      
            ":)=&gt;happy",
            ":(=&gt;sad"
          ]
        }
      }
    }   
  }
}
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><div class="cols-container"><div class="col col-12"><h3>码农阿华</h3><p>联系邮箱：alfredhua@aliyun.com</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/demo1.html" target="_self">概览</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd></dl></div></div><div class="copyright"><span>CopyRight©2019 版权所有 码农阿华 京ICP备19044364号</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>