{
  "filename": "9.IndexTemplate.md",
  "__html": "<h2 id=\"%E4%BB%80%E4%B9%88%E6%98%AFindex-template\">什么是Index Template <a class=\"header-anchor\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFindex-template\">#</a></h2>\n<blockquote>\n<p>Index Templates 帮助你设定Mappings 和Settings，并且按照一定的规则，字段匹配到新创建的索引上。</p>\n</blockquote>\n<ul>\n<li>模板仅在一个索引被创建是才会产生作用，修改模板不会影响已经创建的索引。</li>\n<li>可以设定多个索引模版，这些设置会被“merge”在一起。</li>\n<li>你可以指定“order”的数值，控制“merging”的过程。</li>\n</ul>\n<h2 id=\"inde-template-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F\">Inde Template 的工作方式 <a class=\"header-anchor\" href=\"#inde-template-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F\">#</a></h2>\n<ul>\n<li>当一个索引被创建时\n<ul>\n<li>应用Elasticsearch 默认的settings和mappings</li>\n<li>应用order数值低的Index Template 中的设定</li>\n<li>应用order数值高的Index Template 的设定，之前的设定会被覆盖</li>\n<li>应用创建索引时，用户所指定的Settings和Mappings，并覆盖之前的模板中的设定。</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-json\">PUT ttemplate/_doc/1\n{\n\t\"someNumber\":\"1\",\n\t\"someDate\":\"2019/01/01\"\n}\n</code></pre>\n<p><img src=\"https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/2a4FiA.png\" alt=\"image\"></p>\n<h3 id=\"%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E7%9A%84%E6%A8%A1%E6%9D%BF\">创建一个默认的模板 <a class=\"header-anchor\" href=\"#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E7%9A%84%E6%A8%A1%E6%9D%BF\">#</a></h3>\n<pre><code class=\"language-json\">PUT _template/template_default\n{\n  \"index_patterns\": [\"*\"],\n  \"order\" : 0,\n  \"version\": 1,\n  \"settings\": {\n    \"number_of_shards\": 1,\n    \"number_of_replicas\":1\n  }\n}\n</code></pre>\n<p><img src=\"https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/SQXPzj.png\" alt=\"image\"></p>\n<h3 id=\"%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-dynamic-templates\">创建一个 dynamic templates <a class=\"header-anchor\" href=\"#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-dynamic-templates\">#</a></h3>\n<pre><code class=\"language-json\">PUT my_index\n{\n  \"mappings\": {\n    \"dynamic_templates\": [\n            {\n        \"strings_as_boolean\": {\n          \"match_mapping_type\":   \"string\",\n          \"match\":\"is*\",\n          \"mapping\": {\n            \"type\": \"boolean\"\n          }\n        }\n      },\n      {\n        \"strings_as_keywords\": {\n          \"match_mapping_type\":   \"string\",\n          \"mapping\": {\n            \"type\": \"keyword\"\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>\n<p>![image](/Users/hua/Library/Application Support/typora-user-images/image-20210110162203988.png)</p>\n<p>设置dynamic_templates，并且搜索</p>\n<pre><code class=\"language-json\">PUT my_index\n{\n  \"mappings\": {\n    \"dynamic_templates\": [\n      {\n        \"full_name\": {\n          \"path_match\":   \"name.*\",\n          \"path_unmatch\": \"*.middle\",\n          \"mapping\": {\n            \"type\":       \"text\",\n            \"copy_to\":    \"full_name\"\n          }\n        }\n      }\n    ]\n  }\n}\n\nPUT my_index/_doc/1\n{\n  \"name\": {\n    \"first\":  \"John\",\n    \"middle\": \"Winston\",\n    \"last\":   \"Lennon\"\n  }\n}\n\n\nGET my_index/_search?q=full_name:John\n\n</code></pre>\n",
  "link": "/zh-cn/docs/3.数据库/elasticsearch/9.IndexTemplate.html",
  "meta": {}
}