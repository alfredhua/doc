<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="2.消息模式" />
	<meta name="description" content="2.消息模式" />
	<!-- 网页标签标题 -->
	<title>2.消息模式</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a class="logo" href="/zh-cn/index.html"><span class="logo-normal">码农阿华| <span class="logo-desc">玩玩技术，说说产品</span></span></a><div class="search search-normal"><span class="icon-search"></span></div><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/begin.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>设计模式</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>设计原则<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/1.单一职责.html" target="_self">单一职责</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/2.开闭原则.html" target="_self">开闭原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/3.接口隔离原则.html" target="_self">接口隔离原则</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/4.工厂模式.html" target="_self">工厂模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/5.单例模式.html" target="_self">单例模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/6.原型模式.html" target="_self">原型模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/7.代理模式.html" target="_self">代理模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/8.策略模式.html" target="_self">策略模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/9.委派模式和适配器模式.html" target="_self">委派模式和适配器模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/1.设计模式/10.装饰器模式.html" target="_self">装饰器模式</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>JAVA</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>基础<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/1.HashMap.html" target="_self">HashMap</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/2.integer.html" target="_self">integer</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/3.calculations.html" target="_self">calculations</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/4.LinkedHashMap.html" target="_self">LinkedHashMap</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/5.list.html" target="_self">list</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/6.reference.html" target="_self">reference</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/7.synchronized.html" target="_self">synchronized</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/基础/8.volatile.html" target="_self">volatile</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>JVM<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/1.jvm类加载.html" target="_self">jvm类加载</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/2.栈帧.html" target="_self">栈帧</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/3.内存模型.html" target="_self">内存模型</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/4.垃圾回收.html" target="_self">垃圾回收</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/5.垃圾收集器.html" target="_self">垃圾收集器</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/6.JVM参数.html" target="_self">JVM参数</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/7.JVM常用命令.html" target="_self">JVM常用命令</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/8.JVM常用工具.html" target="_self">JVM常用工具</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/jvm/9.常见问题.html" target="_self">常见问题</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>网络编程<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/网络编程/1.Http.html" target="_self">Http</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/网络编程/2.Socket.html" target="_self">Socket</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>并发编程<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/1.并发基本概念.html" target="_self">并发基本概念</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/2.并发级别.html" target="_self">并发级别</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/3.CountDownLatch.html" target="_self">CountDownLatch</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/4.CyclicBarrier.html" target="_self">CyclicBarrier</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/5.线程池.html" target="_self">线程池</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/6.原子类.html" target="_self">原子类</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.java/并发/7.锁.html" target="_self">锁</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>数据库</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>MySQL<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/1.mysql安装与卸载.html" target="_self">mysql安装与卸载</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/2.忘记和修改密码.html" target="_self">忘记和修改密码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/3.Mysql的基本语法.html" target="_self">Mysql的基本语法</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/4.mysql索引.html" target="_self">mysql索引</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/5.SQL的执行流程.html" target="_self">SQL的执行流程</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/6.MySQL的存储结构.html" target="_self">MySQL的存储结构</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/7.MySQL事务.html" target="_self">MySQL事务</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/8.MySQL锁.html" target="_self">MySQL锁</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/mysql/9.性能优化.html" target="_self">性能优化</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>ElasticSearch<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/1.安装.html" target="_self">安装</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/2.基本概念.html" target="_self">基本概念</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/3.logstash导入数据.html" target="_self">logstash导入数据</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/4.基本操作.html" target="_self">基本操作</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/5.Index操作.html" target="_self">Index操作</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/6.CRUD.html" target="_self">CRUD</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/7.集群操作.html" target="_self">集群操作</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/8.多字段特性及自定义Analyzer.html" target="_self">多字段特性及自定义Analyzer</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/.DS_Stohtml" target="_self">S_St</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/9.IndexTemplate.html" target="_self">IndexTemplate</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/10.聚合.html" target="_self">.聚合</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/11.Term和全文本查询.html" target="_self">.Term和全文本查询</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/elasticsearch/12.错误.html" target="_self">.错误</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>ClickHouse<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/1.介绍.html" target="_self">介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/2.安装教程.html" target="_self">安装教程</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/3.JAVA接入.html" target="_self">JAVA接入</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/4.SQL语法.html" target="_self">SQL语法</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/5.Mysql迁移.html" target="_self">Mysql迁移</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/5.引擎engine.html" target="_self">引擎engine</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/3.数据库/clickhouse/6.HDFS.html" target="_self">HDFS</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>MQ</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>RabbitMQ<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/1.安装.html" target="_self">安装</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/2.消息模式.html" target="_self">消息模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/3.基本操作.html" target="_self">基本操作</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/4.消息可靠性投递.html" target="_self">消息可靠性投递</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/5.重复消费.html" target="_self">重复消费</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/6.消息丢失问题.html" target="_self">消息丢失问题</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/7.高可用.html" target="_self">高可用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/8.消息积压.html" target="_self">消息积压</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/9.死信队列.html" target="_self">死信队列</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/4.mq/rabbitmq/10.如何设计一个MQ.html" target="_self">.如何设计一个MQ</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>框架</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>MyBatis<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/mybatis/1.jdbc连接流程.html" target="_self">jdbc连接流程</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/mybatis/2.源码解读.html" target="_self">源码解读</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/mybatis/3.手写mybatis.html" target="_self">手写mybatis</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/mybatis/4.ORM.html" target="_self">ORM</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Spring<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/1.基本教程.html" target="_self">基本教程</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/2.IOC的XML方式源码分析.html" target="_self">IOC的XML方式源码分析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/3.IOC的注解方式源码解析.html" target="_self">IOC的注解方式源码解析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/4.DI源码解析.html" target="_self">DI源码解析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/5.AOP源码分析.html" target="_self">AOP源码分析</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/6.mvc.html" target="_self">mvc</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring/7.事务.html" target="_self">事务</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>spring-boot<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-boot/1.SpringBoot初识.html" target="_self">SpringBoot初识</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-boot/2.源码解读.html" target="_self">源码解读</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>spring-cloud<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-cloud/1.consul.html" target="_self">consul</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-cloud/2.Ribbon.html" target="_self">Ribbon</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-cloud/3.feign.html" target="_self">feign</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-cloud/4.Config.html" target="_self">Config</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/5.框架/spring-cloud/5.Hystrix.html" target="_self">Hystrix</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>缓存</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Redis<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/1.安装.html" target="_self">安装</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/2.数据类型.html" target="_self">数据类型</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/3.应用场景.html" target="_self">应用场景</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/4.单线程模型.html" target="_self">单线程模型</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/5.过期策略.html" target="_self">过期策略</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/6.数据恢复.html" target="_self">数据恢复</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/7.哨兵模式.html" target="_self">哨兵模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/8.缓冲.html" target="_self">缓冲</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/9.RedisTemplate.html" target="_self">RedisTemplate</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/10.集群.html" target="_self">集群</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/6.缓存/redis/11.lock.html" target="_self">lock</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>分布式</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>zookeeper<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/7.分布式/zookeeper/1.基本概念.html" target="_self">基本概念</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/7.分布式/zookeeper/2.操作.html" target="_self">操作</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/7.分布式/zookeeper/3.使用场景.html" target="_self">使用场景</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/7.分布式/zookeeper/4.分布式锁.html" target="_self">分布式锁</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/7.分布式/zookeeper/5.分布式一致性.html" target="_self">分布式一致性</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/7.分布式/zookeeper/6.集群搭建.html" target="_self">集群搭建</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>服务器</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/8.服务器/1.centos下软件安装.html" target="_self">centos下软件安装</a></li></ul></li><li class="menu-item menu-item-level-1"><span>算法</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>算法<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/9.算法/1.递归.html" target="_self">递归</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/9.算法/2.排序.html" target="_self">排序</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/9.算法/3.双子针.html" target="_self">双子针</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/9.算法/4.回溯.html" target="_self">回溯</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>工具</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>arthas<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/arthas/1.安装.html" target="_self">安装</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/arthas/2.dashboard.html" target="_self">dashboard</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/arthas/3.thread.html" target="_self">thread</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/arthas/4.JVM.html" target="_self">JVM</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>docker<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/docker/1.安装.html" target="_self">安装</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>k8s<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/k8s/1.环境搭建.html" target="_self">环境搭建</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/k8s/2.kubectl.html" target="_self">kubectl</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>maven<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/10.工具/maven/1.解决依赖冲突.html" target="_self">解决依赖冲突</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>面试</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/面试/java基础.html" target="_self">java基础</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/面试/mybatis.html" target="_self">mybatis</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/面试/mysql.html" target="_self">mysql</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/面试/nginx.html" target="_self">nginx</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/面试/nginx.html" target="_self">nginx</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h2 id="%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F">简单模式 <a class="header-anchor" href="#%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F">#</a></h2>
<p>一个生产者P发送消息到队列Q,一个消费者C接收</p>
<p><a href="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/u=3536793445,2882105203&amp;fm=26&amp;gp=0.gif">https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/u=3536793445,2882105203&amp;fm=26&amp;gp=0.gif</a></p>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/file/9e555b0d8fa144cfbb3421e3b19a018f" alt="image"></p>
<pre><code class="language-java">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Send</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String QUEUE_NAME = <span class="hljs-string">"hello"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);
        <span class="hljs-keyword">try</span> (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {
            channel.queueDeclare(QUEUE_NAME, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
            String message = <span class="hljs-string">"Hello World!"</span>;
            channel.basicPublish(<span class="hljs-string">""</span>, QUEUE_NAME, <span class="hljs-keyword">null</span>, message.getBytes(StandardCharsets.UTF_8));
            System.out.println(<span class="hljs-string">" [x] Sent '"</span> + message + <span class="hljs-string">"'"</span>);
        }
    }
}

</code></pre>
<pre><code class="language-java">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recv</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String QUEUE_NAME = <span class="hljs-string">"hello"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();
    channel.queueDeclare(QUEUE_NAME, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
    System.out.println(<span class="hljs-string">" [*] Waiting for messages. To exit press CTRL+C"</span>);

  }
}

</code></pre>
<h2 id="%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8Fwork-queue">工作队列模式Work Queue <a class="header-anchor" href="#%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8Fwork-queue">#</a></h2>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/file/f25207b901d94d2fbbad2f3d0245aa0d" alt="image"></p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NewTask</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TASK_QUEUE_NAME = <span class="hljs-string">"task_queue"</span>;
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    <span class="hljs-keyword">try</span> (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {
        channel.queueDeclare(TASK_QUEUE_NAME, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);

        String message = String.join(<span class="hljs-string">" "</span>, argv);

        channel.basicPublish(<span class="hljs-string">""</span>, TASK_QUEUE_NAME,
                MessageProperties.PERSISTENT_TEXT_PLAIN,
                message.getBytes(<span class="hljs-string">"UTF-8"</span>));
        System.out.println(<span class="hljs-string">" [x] Sent '"</span> + message + <span class="hljs-string">"'"</span>);
    }
  }
}
</code></pre>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Recv</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TASK_QUEUE_NAME = <span class="hljs-string">"task_queue"</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);
        factory.setUsername(<span class="hljs-string">"guest"</span>);
        factory.setPassword(<span class="hljs-string">"guest"</span>);
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();
        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
            String message = <span class="hljs-keyword">new</span> String(delivery.getBody(), <span class="hljs-string">"UTF-8"</span>);
            System.out.println(<span class="hljs-string">" [x] Received '"</span> + message + <span class="hljs-string">"'"</span>);
            <span class="hljs-keyword">try</span> {
                doWork(message);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            } <span class="hljs-keyword">finally</span> {
                System.out.println(<span class="hljs-string">" [x] Done"</span>);
            }
        };
        <span class="hljs-keyword">boolean</span> autoAck = <span class="hljs-keyword">true</span>; <span class="hljs-comment">// acknowledgment is covered below</span>
        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, consumerTag -&gt; { });

    }
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doWork</span><span class="hljs-params">(String task)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> ch: task.toCharArray()) {
            <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">'.'</span>) Thread.sleep(<span class="hljs-number">1000</span>);
        }
    }
}

</code></pre>
<h2 id="%E5%8F%91%E5%B8%83%2F%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8Fpublish%2Fsubscribe">发布/订阅模式Publish/Subscribe <a class="header-anchor" href="#%E5%8F%91%E5%B8%83%2F%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8Fpublish%2Fsubscribe">#</a></h2>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/file/64d071ed89c74822988c6b7554ecc4c9" alt="image"></p>
<p>功能：一个生产者发送的消息会被多个消费者获取。一个生产者、一个交换机、多个队列、多个消费者</p>
<p>生产者：可以将消息发送到队列或者是交换机。</p>
<p>消费者：只能从队列中获取消息。</p>
<p>如果消息发送到没有队列绑定的交换机上，那么消息将丢失。
交换机不能存储消息，消息存储在队列中</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmitLog</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_NAME = <span class="hljs-string">"logs"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    <span class="hljs-keyword">try</span> (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {
        channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">"fanout"</span>);

        String message = argv.length &lt; <span class="hljs-number">1</span> ? <span class="hljs-string">"info: Hello World!"</span> :
                            String.join(<span class="hljs-string">" "</span>, argv);

        channel.basicPublish(EXCHANGE_NAME, <span class="hljs-string">""</span>, <span class="hljs-keyword">null</span>, message.getBytes(<span class="hljs-string">"UTF-8"</span>));
        System.out.println(<span class="hljs-string">" [x] Sent '"</span> + message + <span class="hljs-string">"'"</span>);
    }
  }
}

</code></pre>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReceiveLogs</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_NAME = <span class="hljs-string">"logs"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">"fanout"</span>);
    String queueName = channel.queueDeclare().getQueue();
    channel.queueBind(queueName, EXCHANGE_NAME, <span class="hljs-string">""</span>);

    System.out.println(<span class="hljs-string">" [*] Waiting for messages. To exit press CTRL+C"</span>);

    DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
        String message = <span class="hljs-keyword">new</span> String(delivery.getBody(), <span class="hljs-string">"UTF-8"</span>);
        System.out.println(<span class="hljs-string">" [x] Received '"</span> + message + <span class="hljs-string">"'"</span>);
    };
    channel.basicConsume(queueName, <span class="hljs-keyword">true</span>, deliverCallback, consumerTag -&gt; { });
  }
}

</code></pre>
<h2 id="%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8Frouting">路由模式Routing <a class="header-anchor" href="#%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8Frouting">#</a></h2>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/file/6548ba200d1a4e25a074cdf243fdb667" alt="image"></p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmitLogDirect</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_NAME = <span class="hljs-string">"direct_logs"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    <span class="hljs-keyword">try</span> (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {
        channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">"direct"</span>);

        String severity = getSeverity(argv);
        String message = getMessage(argv);

        channel.basicPublish(EXCHANGE_NAME, severity, <span class="hljs-keyword">null</span>, message.getBytes(<span class="hljs-string">"UTF-8"</span>));
        System.out.println(<span class="hljs-string">" [x] Sent '"</span> + severity + <span class="hljs-string">"':'"</span> + message + <span class="hljs-string">"'"</span>);
    }
  }
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getSeverity</span><span class="hljs-params">(String[] strings)</span> </span>{
        <span class="hljs-keyword">if</span> (strings.length &lt; <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"info"</span>;
        <span class="hljs-keyword">return</span> strings[<span class="hljs-number">0</span>];
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getMessage</span><span class="hljs-params">(String[] strings)</span> </span>{
        <span class="hljs-keyword">if</span> (strings.length &lt; <span class="hljs-number">2</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!"</span>;
        <span class="hljs-keyword">return</span> joinStrings(strings, <span class="hljs-string">" "</span>, <span class="hljs-number">1</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">joinStrings</span><span class="hljs-params">(String[] strings, String delimiter, <span class="hljs-keyword">int</span> startIndex)</span> </span>{
        <span class="hljs-keyword">int</span> length = strings.length;
        <span class="hljs-keyword">if</span> (length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (length &lt;= startIndex) <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        StringBuilder words = <span class="hljs-keyword">new</span> StringBuilder(strings[startIndex]);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = startIndex + <span class="hljs-number">1</span>; i &lt; length; i++) {
            words.append(delimiter).append(strings[i]);
        }
        <span class="hljs-keyword">return</span> words.toString();
    }
}

</code></pre>
<pre><code class="language-java">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReceiveLogsDirect</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_NAME = <span class="hljs-string">"direct_logs"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">"direct"</span>);
    String queueName = channel.queueDeclare().getQueue();

    <span class="hljs-keyword">if</span> (argv.length &lt; <span class="hljs-number">1</span>) {
        System.err.println(<span class="hljs-string">"Usage: ReceiveLogsDirect [info] [warning] [error]"</span>);
        System.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">for</span> (String severity : argv) {
        channel.queueBind(queueName, EXCHANGE_NAME, severity);
    }
    System.out.println(<span class="hljs-string">" [*] Waiting for messages. To exit press CTRL+C"</span>);

    DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
        String message = <span class="hljs-keyword">new</span> String(delivery.getBody(), <span class="hljs-string">"UTF-8"</span>);
        System.out.println(<span class="hljs-string">" [x] Received '"</span> +
            delivery.getEnvelope().getRoutingKey() + <span class="hljs-string">"':'"</span> + message + <span class="hljs-string">"'"</span>);
    };
    channel.basicConsume(queueName, <span class="hljs-keyword">true</span>, deliverCallback, consumerTag -&gt; { });
  }
}
</code></pre>
<h2 id="%E9%80%9A%E9%85%8D%E7%AC%A6%E6%A8%A1%E5%BC%8Ftopics">通配符模式Topics <a class="header-anchor" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E6%A8%A1%E5%BC%8Ftopics">#</a></h2>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/file/2b79943e38774069b49cf6893437fb9c" alt="image"></p>
<p>生产者P发送消息到交换机X，type=topic，交换机根据绑定队列的routing key的值进行通配符匹配；
符号#：匹配一个或者多个词lazy.# 可以匹配lazy.irs或者lazy.irs.cor</p>
<pre><code class="language-java">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmitLogTopic</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_NAME = <span class="hljs-string">"topic_logs"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    <span class="hljs-keyword">try</span> (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {

        channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">"topic"</span>);

        String routingKey = getRouting(argv);
        String message = getMessage(argv);

        channel.basicPublish(EXCHANGE_NAME, routingKey, <span class="hljs-keyword">null</span>, message.getBytes(<span class="hljs-string">"UTF-8"</span>));
        System.out.println(<span class="hljs-string">" [x] Sent '"</span> + routingKey + <span class="hljs-string">"':'"</span> + message + <span class="hljs-string">"'"</span>);
    }
  }
   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getRouting</span><span class="hljs-params">(String[] strings)</span> </span>{
        <span class="hljs-keyword">if</span> (strings.length &lt; <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"anonymous.info"</span>;
        <span class="hljs-keyword">return</span> strings[<span class="hljs-number">0</span>];
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getMessage</span><span class="hljs-params">(String[] strings)</span> </span>{
        <span class="hljs-keyword">if</span> (strings.length &lt; <span class="hljs-number">2</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!"</span>;
        <span class="hljs-keyword">return</span> joinStrings(strings, <span class="hljs-string">" "</span>, <span class="hljs-number">1</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">joinStrings</span><span class="hljs-params">(String[] strings, String delimiter, <span class="hljs-keyword">int</span> startIndex)</span> </span>{
        <span class="hljs-keyword">int</span> length = strings.length;
        <span class="hljs-keyword">if</span> (length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (length &lt; startIndex) <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        StringBuilder words = <span class="hljs-keyword">new</span> StringBuilder(strings[startIndex]);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = startIndex + <span class="hljs-number">1</span>; i &lt; length; i++) {
            words.append(delimiter).append(strings[i]);
        }
        <span class="hljs-keyword">return</span> words.toString();
    }
}

</code></pre>
<pre><code class="language-java">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReceiveLogsTopic</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_NAME = <span class="hljs-string">"topic_logs"</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
    factory.setHost(<span class="hljs-string">"localhost"</span>);
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">"topic"</span>);
    String queueName = channel.queueDeclare().getQueue();

    <span class="hljs-keyword">if</span> (argv.length &lt; <span class="hljs-number">1</span>) {
        System.err.println(<span class="hljs-string">"Usage: ReceiveLogsTopic [binding_key]..."</span>);
        System.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">for</span> (String bindingKey : argv) {
        channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);
    }

    System.out.println(<span class="hljs-string">" [*] Waiting for messages. To exit press CTRL+C"</span>);

    DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
        String message = <span class="hljs-keyword">new</span> String(delivery.getBody(), <span class="hljs-string">"UTF-8"</span>);
        System.out.println(<span class="hljs-string">" [x] Received '"</span> +
            delivery.getEnvelope().getRoutingKey() + <span class="hljs-string">"':'"</span> + message + <span class="hljs-string">"'"</span>);
    };
    channel.basicConsume(queueName, <span class="hljs-keyword">true</span>, deliverCallback, consumerTag -&gt; { });
  }
}

</code></pre>
<h2 id="rpc">RPC <a class="header-anchor" href="#rpc">#</a></h2>
<p><img src="http://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/file/5f96e1ef416148e98a833ed10de4be44" alt="image"></p>
<pre><code class="language-java">


<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RPCServer</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String RPC_QUEUE_NAME = <span class="hljs-string">"rpc_queue"</span>;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">fib</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>{
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> fib(n - <span class="hljs-number">1</span>) + fib(n - <span class="hljs-number">2</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-keyword">try</span> (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {
            channel.queueDeclare(RPC_QUEUE_NAME, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
            channel.queuePurge(RPC_QUEUE_NAME);

            channel.basicQos(<span class="hljs-number">1</span>);

            System.out.println(<span class="hljs-string">" [x] Awaiting RPC requests"</span>);

            Object monitor = <span class="hljs-keyword">new</span> Object();
            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {
                AMQP.BasicProperties replyProps = <span class="hljs-keyword">new</span> AMQP.BasicProperties
                        .Builder()
                        .correlationId(delivery.getProperties().getCorrelationId())
                        .build();

                String response = <span class="hljs-string">""</span>;

                <span class="hljs-keyword">try</span> {
                    String message = <span class="hljs-keyword">new</span> String(delivery.getBody(), <span class="hljs-string">"UTF-8"</span>);
                    <span class="hljs-keyword">int</span> n = Integer.parseInt(message);

                    System.out.println(<span class="hljs-string">" [.] fib("</span> + message + <span class="hljs-string">")"</span>);
                    response += fib(n);
                } <span class="hljs-keyword">catch</span> (RuntimeException e) {
                    System.out.println(<span class="hljs-string">" [.] "</span> + e.toString());
                } <span class="hljs-keyword">finally</span> {
                    channel.basicPublish(<span class="hljs-string">""</span>, delivery.getProperties().getReplyTo(), replyProps, response.getBytes(<span class="hljs-string">"UTF-8"</span>));
                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="hljs-keyword">false</span>);
                    <span class="hljs-comment">// RabbitMq consumer worker thread notifies the RPC server owner thread</span>
                    <span class="hljs-keyword">synchronized</span> (monitor) {
                        monitor.notify();
                    }
                }
            };

            channel.basicConsume(RPC_QUEUE_NAME, <span class="hljs-keyword">false</span>, deliverCallback, (consumerTag -&gt; { }));
            <span class="hljs-comment">// Wait and be prepared to consume the message from RPC client.</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) {
                <span class="hljs-keyword">synchronized</span> (monitor) {
                    <span class="hljs-keyword">try</span> {
                        monitor.wait();
                    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }
        }
    }
}

</code></pre>
<pre><code class="language-java">
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RPCClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AutoCloseable</span> </span>{

    <span class="hljs-keyword">private</span> Connection connection;
    <span class="hljs-keyword">private</span> Channel channel;
    <span class="hljs-keyword">private</span> String requestQueueName = <span class="hljs-string">"rpc_queue"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RPCClient</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>{
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);

        connection = factory.newConnection();
        channel = connection.createChannel();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] argv)</span> </span>{
        <span class="hljs-keyword">try</span> (RPCClient fibonacciRpc = <span class="hljs-keyword">new</span> RPCClient()) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
                String i_str = Integer.toString(i);
                System.out.println(<span class="hljs-string">" [x] Requesting fib("</span> + i_str + <span class="hljs-string">")"</span>);
                String response = fibonacciRpc.call(i_str);
                System.out.println(<span class="hljs-string">" [.] Got '"</span> + response + <span class="hljs-string">"'"</span>);
            }
        } <span class="hljs-keyword">catch</span> (IOException | TimeoutException | InterruptedException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">(String message)</span> <span class="hljs-keyword">throws</span> IOException, InterruptedException </span>{
        <span class="hljs-keyword">final</span> String corrId = UUID.randomUUID().toString();

        String replyQueueName = channel.queueDeclare().getQueue();
        AMQP.BasicProperties props = <span class="hljs-keyword">new</span> AMQP.BasicProperties
                .Builder()
                .correlationId(corrId)
                .replyTo(replyQueueName)
                .build();

        channel.basicPublish(<span class="hljs-string">""</span>, requestQueueName, props, message.getBytes(<span class="hljs-string">"UTF-8"</span>));

        <span class="hljs-keyword">final</span> BlockingQueue&lt;String&gt; response = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">1</span>);

        String ctag = channel.basicConsume(replyQueueName, <span class="hljs-keyword">true</span>, (consumerTag, delivery) -&gt; {
            <span class="hljs-keyword">if</span> (delivery.getProperties().getCorrelationId().equals(corrId)) {
                response.offer(<span class="hljs-keyword">new</span> String(delivery.getBody(), <span class="hljs-string">"UTF-8"</span>));
            }
        }, consumerTag -&gt; {
        });

        String result = response.take();
        channel.basicCancel(ctag);
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
        connection.close();
    }
}

</code></pre>
<h2 id="%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E4%BA%A4%E6%8D%A2%E5%99%A8-fanout%2Cdirect%2Ctopic">三种类型交换器 Fanout,Direct,Topic <a class="header-anchor" href="#%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E4%BA%A4%E6%8D%A2%E5%99%A8-fanout%2Cdirect%2Ctopic">#</a></h2>
<p>fanout：不处理路由键。你只需要简单的将队列绑定到交换机上。一个发送到交换机的消息都会被转发到与该交换机绑定的所有队列上。很像子网广播，每台子网内的主机都获得了一份复制的消息。Fanout交换机转发消息是最快的。</p>
<p>direct：处理路由键。需要将一个队列绑定到交换机上，要求该消息与一个特定的路由键完全匹配。这是一个完整的匹配。如果一个队列绑定到该交换机上要求路由键 “test”，则只有被标记为“test”的消息才被转发，不会转发test.aaa，也不会转发dog.123，只会转发test。</p>
<p>topic：将路由键和某模式进行匹配。此时队列需要绑定要一个模式上。符号“#”匹配一个或多个词，符号“<em>”匹配不多不少一个词。因此“audit.#”能够匹配到“audit.irs.corporate”，但是“audit.</em>” 只会匹配到“audit.irs”。</p>
<p><img src="https://java-run-blog.oss-cn-zhangjiakou.aliyuncs.com/blog/qrcode_for_gh_55da400f21ce_344.jpg" style="width:200px;height:200px;margin-left:100px"></img></p>
<div style="margin-left:50px;color:red;font-size:32px">关注公众号，精彩继续</div></div></section><footer class="footer-container"><div class="footer-body"><div class="cols-container"><div class="col col-12"><h3>码农阿华</h3><p>联系邮箱：alfredhua@aliyun.com</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/demo1.html" target="_self">概览</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd></dl></div></div><div class="copyright"><span>CopyRight©2019 版权所有 码农阿华 京ICP备19044364号</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>