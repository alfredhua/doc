{
  "filename": "2.操作.md",
  "__html": "<h2 id=\"%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%8Ccreate%EF%BC%8Cupdate%EF%BC%8Cdelete\">基本操作，create，update，delete <a class=\"header-anchor\" href=\"#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%8Ccreate%EF%BC%8Cupdate%EF%BC%8Cdelete\">#</a></h2>\n<pre><code class=\"language-java\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{\n    CuratorFrameworkFactory.Builder builder = CuratorFrameworkFactory.builder();\n\n    CuratorFramework curatorFramework = builder.connectString(CONNECTION_STR).\n            sessionTimeoutMs(<span class=\"hljs-number\">5000</span>).\n            retryPolicy(<span class=\"hljs-keyword\">new</span> ExponentialBackoffRetry(<span class=\"hljs-number\">100</span>, <span class=\"hljs-number\">3</span>)).build();\n\n    curatorFramework.start();\n    createNode(curatorFramework);\n<span class=\"hljs-comment\">//    updateNode(curatorFramework);</span>\n<span class=\"hljs-comment\">//    deleteNode(curatorFramework);</span>\n  }\n\n   <span class=\"hljs-comment\">/**创建**/</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">createNode</span><span class=\"hljs-params\">(CuratorFramework curatorFramework)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{\n      curatorFramework.create().creatingParentContainersIfNeeded()\n          .withMode(CreateMode.PERSISTENT).forPath(<span class=\"hljs-string\">\"/data/program\"</span>,<span class=\"hljs-string\">\"test\"</span>.getBytes());\n  }\n  <span class=\"hljs-comment\">/**更新*/</span>\n   <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">updateNode</span><span class=\"hljs-params\">(CuratorFramework curatorFramework)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{\n    curatorFramework.setData().forPath(<span class=\"hljs-string\">\"/data/program\"</span>,<span class=\"hljs-string\">\"aaa\"</span>.getBytes());\n  }\n  <span class=\"hljs-comment\">/*删除*/</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">deleteNode</span><span class=\"hljs-params\">(CuratorFramework curatorFramework)</span>  <span class=\"hljs-keyword\">throws</span> Exception </span>{\n    Stat stat=<span class=\"hljs-keyword\">new</span> Stat();\n    <span class=\"hljs-keyword\">final</span> String s = <span class=\"hljs-keyword\">new</span> String(curatorFramework.getData().storingStatIn(stat).forPath(<span class=\"hljs-string\">\"/data/program\"</span>));\n    curatorFramework.delete().withVersion(stat.getVersion()).forPath(<span class=\"hljs-string\">\"/data/program\"</span>);\n  }\n\n</code></pre>\n<h2 id=\"watch\">Watch <a class=\"header-anchor\" href=\"#watch\">#</a></h2>\n<pre><code class=\"language-java\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{\n    CuratorFrameworkFactory.Builder builder = CuratorFrameworkFactory.builder();\n    CuratorFramework curatorFramework = builder.connectString(CONNECTION_STR).sessionTimeoutMs(<span class=\"hljs-number\">5000</span>).retryPolicy(<span class=\"hljs-keyword\">new</span> ExponentialBackoffRetry(<span class=\"hljs-number\">100</span>, <span class=\"hljs-number\">3</span>)).build();\n    curatorFramework.start();\n    addListenerWithChild(curatorFramework);\n    System.in.read();\n  }\n\n   <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addListenerWithNode</span><span class=\"hljs-params\">(CuratorFramework curatorFramework)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{\n    NodeCache nodeCache =<span class=\"hljs-keyword\">new</span> NodeCache(curatorFramework,<span class=\"hljs-string\">\"/watch\"</span>,<span class=\"hljs-keyword\">false</span>);\n    NodeCacheListener nodeCacheListener= () -&gt;{\n      System.out.println(<span class=\"hljs-string\">\"receive Node Changed\"</span>);\n      System.out.println(nodeCache.getCurrentData().getPath()+<span class=\"hljs-string\">\"---\"</span>+<span class=\"hljs-keyword\">new</span> String(nodeCache.getCurrentData().getData()));\n    };\n    nodeCache.getListenable().addListener(nodeCacheListener);\n    nodeCache.start();\n  }\n\n\n</code></pre>\n",
  "link": "/zh-cn/docs/7.分布式/zookeeper/2.操作.html",
  "meta": {}
}